<apex:page showHeader="true" sidebar="true" controller="FitBitController" title="Fitbit Connect">
	<style>
		#overlay {
			position: absolute;
			z-index: 9998;
			height: 100%;
			width: 100%;
			background: #000;
			opacity: 0.2;
			filter: alpha(opacity = 20);
			top: 0;
			left: 0;
		}
		#loadingPopover {
			width: 250px;
			height: 30px;
			background: url('/img/loading32.gif') 40px 50% no-repeat #fff;
			font-size: 24px;
			position: fixed;
			left: 50%;
			margin-left: -125px;
			padding: 20px;
			border-radius: 10px;
			top: 50%;
			margin-top: -15px;
			box-shadow: 0 0 8px #888;
			z-index: 9999;
			line-height: 30px;
			text-indent: 70px;
		}
	</style>
	
	<apex:sectionHeader title="Fitbit Connect" subtitle="{!$User.FirstName} {!$User.LastName}" />
	
	<apex:pageBlock rendered="{!needsAuthorization}">
		<apex:pageMessages id="pageMessages" />
		
		<apex:form >
			<div>In order for Salesfore to retrieve your Fitbit data, you must click the button below. Clicking the button will take you to Fitbit&rsquo;s website and allow you to authorize Salesforce to request your Fitbit stats. Salesforce will not be able to see or access your Fitbit username or password.</div>
			
			<div id="authorization-button">
				<apex:commandButton value="Authorize" action="{!authorize}" status="loadingStatus" />
			</div>
		</apex:form>
	</apex:pageBlock>
	
	<apex:pageBlock rendered="{!!needsAuthorization}" id="authorizedBlock">
		<apex:pageMessages id="pageMessages" />
		
		<apex:form>
			<div>Click the button below to retrieve the latest stats from Fitbit&rsquo;s server.</div>
			
			<apex:commandButton value="Get Stats" action="{!fetchToday}" reRender="authorizedBlock" status="loadingStatus" />
			
			<p><strong>Activity Id: </strong> {!activityId}</p>
		</apex:form>
	</apex:pageBlock>
	
	<div class="loadingStatusContainer">
		<apex:actionStatus id="loadingStatus">
			<apex:facet name="start">
				<div id="overlay"></div>
				<div id="loadingPopover">Loading</div>
			</apex:facet>
		</apex:actionStatus>
	</div>
</apex:page>